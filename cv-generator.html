<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mon CV Facile - EmploiAvenir</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --primary-color: #1877f2;
      --secondary-color: #145fc0;
      --success-color: #22b573;
      --success-hover-color: #189e5b;
      --danger-color: #dc3545;
      --danger-hover-color: #c82333;
      --light-bg-color: #f6f8fa;
      --container-bg-color: #fff;
      --text-color: #333;
      --label-color: #444;
      --border-color: #d1d5db;
      --border-radius: 6px;
      --box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      --font-main: 'Inter', Arial, sans-serif;
    }

    body {
      font-family: var(--font-main);
      background: var(--light-bg-color);
      margin: 0;
      padding: 20px 15px; /* Plus d'espace */
      color: var(--text-color);
      font-size: 16px; /* Taille de base augmentée */
      line-height: 1.7; /* Interligne augmenté */
    }

    .header {
      background: var(--container-bg-color);
      border-bottom: 1px solid var(--border-color);
      padding: 20px 0;
      text-align: center;
      font-size: 2em; /* Plus grand */
      font-weight: 700;
      color: var(--primary-color);
      letter-spacing: 0.5px;
      margin-bottom: 30px;
      box-shadow: var(--box-shadow);
      border-radius: var(--border-radius);
    }

    .main-container { /* Nouveau conteneur pour centrer sur les grands écrans */
        max-width: 1200px;
        margin: 0 auto;
    }

    .cv-layout {
      display: flex;
      flex-direction: column; /* Par défaut en colonne pour mobile */
      gap: 30px;
      align-items: stretch; /* S'assurer que les colonnes prennent toute la largeur */
    }

    .form-column, .preview-column {
      background: var(--container-bg-color);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px; /* Padding augmenté */
      width: 100%; /* Prend toute la largeur en mobile */
      box-sizing: border-box;
    }

    .form-column h2, .preview-column .preview-title-text {
      color: var(--primary-color);
      font-size: 1.5em; /* Titres plus grands */
      border-bottom: 2px solid #e0e4e8;
      padding-bottom: 10px;
      margin-top: 0;
      margin-bottom: 25px;
    }

    .form-group { margin-bottom: 20px; } /* Plus d'espace */

    .form-group label {
      font-weight: 600;
      display: flex; /* Pour aligner icône et texte */
      align-items: center;
      gap: 8px;
      margin-bottom: 8px; /* Plus d'espace */
      font-size: 1.1em; /* Labels plus grands */
      color: var(--label-color);
    }
    .form-group label i {
      color: var(--primary-color);
      font-size: 1.1em;
    }

    input[type="text"], input[type="email"], input[type="tel"], textarea {
      width: 100%;
      padding: 12px 10px; /* Champs plus grands */
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 1em; /* Taille relative au body */
      background: #fdfdfd;
      box-sizing: border-box;
      font-family: var(--font-main);
    }
    input:focus, textarea:focus {
        border-color: var(--primary-color);
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
    }

    textarea {
        min-height: 100px;
    }

    .section-title { /* Utilisé pour les titres secondaires dans le formulaire */
      color: var(--primary-color);
      font-size: 1.3em; /* Plus grand */
      font-weight: 600;
      border-bottom: 1px solid #e0e4e8;
      margin-top: 30px;
      margin-bottom: 20px;
      padding-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .section-title i { font-size: 1em; }


    .action-button { /* Style commun pour les boutons principaux */
      width: 100%;
      color: #fff;
      border: none;
      font-size: 1.15em; /* Plus grand */
      font-weight: 600;
      padding: 15px 10px; /* Plus hauts */
      border-radius: var(--border-radius);
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-decoration: none; /* Pour les liens stylés en bouton */
      box-sizing: border-box;
    }
    .action-button:hover { transform: translateY(-1px); }
    .action-button:active { transform: translateY(0px); }


    .btn-pdf {
      background: var(--success-color);
      margin-bottom: 15px;
    }
    .btn-pdf:hover { background: var(--success-hover-color); }
    .btn-pdf:disabled { background: #aaa; cursor: not-allowed; }


    .btn-lm {
      background: var(--primary-color);
    }
    .btn-lm:hover { background: var(--secondary-color); }


    .add-item-btn {
      background: var(--primary-color);
      color: #fff;
      border: none;
      padding: 10px 18px; /* Plus grand */
      border-radius: var(--border-radius);
      font-size: 1em;
      cursor: pointer;
      margin-top: 10px;
      margin-bottom: 15px;
      transition: background 0.2s;
      display: inline-flex; /* Pour aligner icône et texte */
      align-items: center;
      gap: 8px;
    }
    .add-item-btn:hover { background: var(--secondary-color); }

    .dynamic-item-container { /* Conteneur pour un bloc d'expérience/formation */
        border: 1px dashed var(--border-color);
        padding: 20px;
        margin-bottom: 20px;
        border-radius: var(--border-radius);
        position: relative;
        background-color: #fbfcfd;
    }
    .remove-item-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--danger-color);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        padding: 6px 10px;
        font-size: 0.9em;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }
    .remove-item-btn:hover { background: var(--danger-hover-color); }
    .remove-item-btn i { margin-right: 3px;}


    /* Aperçu CV */
    .cv-preview-box {
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 30px 25px; /* Plus d'espace */
      margin-bottom: 25px;
      text-align: center;
      background: #fdfdfd;
      font-size: 0.9rem; /* Ajuster pour que ça tienne bien */
    }
    .cv-name-preview {
      font-size: 1.8em; /* Plus grand */
      font-weight: 700;
      margin: 0 0 8px 0;
      color: var(--text-color);
    }
    .cv-contact-preview {
      font-size: 0.95em;
      color: #555;
      margin-bottom: 10px;
      line-height: 1.5;
    }
    .cv-job-title-preview {
      font-size: 1.2em; /* Plus grand */
      font-weight: 600;
      margin-top: 15px;
      margin-bottom: 15px;
      color: var(--primary-color);
    }
    .cv-section-preview {
      text-align: left;
      margin: 20px 0 0 0;
      font-size: 1em;
      color: var(--text-color);
    }
    .cv-section-preview h4 { /* Titres de section dans l'aperçu */
        font-size: 1.1em;
        color: var(--secondary-color);
        margin-bottom: 8px;
        border-bottom: 1px solid #eee;
        padding-bottom: 4px;
    }
    .cv-section-preview ul {
      margin: 6px 0 0 0; /* Pas de marge à gauche pour la liste */
      padding-left: 20px; /* Indentation des puces */
      list-style: disc; /* Puces standard */
    }
    .cv-section-preview ul li {
        margin-bottom: 5px;
    }

    /* Responsive pour Desktop */
    @media (min-width: 900px) {
      .cv-layout {
        flex-direction: row;
        align-items: flex-start; /* Aligner en haut */
      }
      .form-column {
        flex: 2; /* Le formulaire prend plus de place */
      }
      .preview-column {
        flex: 3; /* L'aperçu prend un peu plus de place pour être bien visible */
        position: sticky; /* Pour que l'aperçu suive le scroll */
        top: 20px;
        max-height: calc(100vh - 40px); /* Limiter la hauteur */
        overflow-y: auto; /* Permettre le scroll interne si besoin */
      }
      .cv-preview-box { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <header class="header-navigation" id="header">
    <div class="header-container flex justify-between items-center">
      <a href="index.html" class="logo" aria-label="Accueil EmploiAvenir"><span>Emploi</span>Avenir</a>
      <nav aria-label="Navigation principale">
        <ul class="nav-links" id="mainNavLinks">
          <li><a href="index.html" class="active" data-i18n="Home">Accueil</a></li>
          <li><a href="MonParcours.html" data-i18n="Parcours">Mon Parcours</a></li>
          <li><a href="MesCandidature.html" data-i18n="Candidatures">Mes Candidatures</a></li>
          <li><a href="Partenaires.html" data-i18n="Partenaires">Nos partenaires</a></li>
          <li><a href="Documents.html" data-i18n="Documents">Mes documents</a></li>
          <li><a href="formation.html" data-i18n="Se former">Se former</a></li>
          <li><a href="Profil.html" data-i18n="Profil">Profil</a></li>
        </ul>
      </nav>
      <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Ouvrir le menu de navigation" aria-expanded="false" aria-controls="mainNavLinks">☰</button>
    </div>
  </header>
  <div class="main-container">
    <div class="cv-layout">
      <div class="form-column">
        <h2><i class="fas fa-pencil-alt"></i> Remplissez votre CV</h2>

        <div class="form-group">
          <label for="fullname"><i class="fas fa-user"></i> Nom complet :</label>
          <input type="text" id="fullname" placeholder="Ex: Jean Dupont" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="email"><i class="fas fa-envelope"></i> Email :</label>
          <input type="email" id="email" placeholder="Ex: jean.dupont@email.com" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="phone"><i class="fas fa-phone"></i> Téléphone :</label>
          <input type="tel" id="phone" placeholder="Ex: 06 12 34 56 78" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="address"><i class="fas fa-map-marker-alt"></i> Votre ville :</label>
          <input type="text" id="address" placeholder="Ex: Paris (ou 75000 Paris)" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="jobtitle"><i class="fas fa-briefcase"></i> Titre du CV (ex: votre métier) :</label>
          <input type="text" id="jobtitle" placeholder="Ex: Agent d'accueil polyvalent" oninput="updatePreview()">
        </div>

        <h3 class="section-title"><i class="fas fa-user-tie"></i> Quelques mots sur vous (optionnel)</h3>
        <div class="form-group">
          <label for="summary">Décrivez brièvement votre recherche ou vos qualités :</label>
          <textarea id="summary" rows="4" placeholder="Ex: Motivé et dynamique, je recherche un poste où je pourrai mettre à profit mon sens du contact." oninput="updatePreview()"></textarea>
        </div>

        <h3 class="section-title"><i class="fas fa-history"></i> Vos Expériences</h3>
        <div id="experiencesContainer">
          {/* Les expériences seront ajoutées ici par JavaScript */}
        </div>
        <button type="button" class="add-item-btn" onclick="addExperience()">
          <i class="fas fa-plus-circle"></i> Ajouter une expérience
        </button>

        <h3 class="section-title"><i class="fas fa-graduation-cap"></i> Vos Formations / Diplômes</h3>
        <div id="educationsContainer">
        </div>
        <button type="button" class="add-item-btn" onclick="addEducation()">
          <i class="fas fa-plus-circle"></i> Ajouter une formation
        </button>

        <h3 class="section-title"><i class="fas fa-star"></i> Vos Compétences</h3>
        <div class="form-group">
          <label for="skills">Listez vos compétences (séparées par des virgules) :</label>
          <input type="text" id="skills" placeholder="Ex: Ponctualité, Travail d'équipe, Esprit d'initiative" oninput="updatePreview()">
          <small style="display:block; margin-top:5px; font-size:0.9em; color:#666;">Exemple : Accueil, Sourire, Caisse, Anglais de base</small>
        </div>
      </div>

      <div class="preview-column">
        <h2 class="preview-title-text"><i class="far fa-eye"></i> Aperçu de votre CV</h2>
        <div class="cv-preview-box" id="cvPreviewRender">
          <div class="cv-name-preview" id="cvNamePreview">Prénom NOM</div>
          <div class="cv-contact-preview" id="cvContactPreview">email@example.com  |  0102030405  |  Ville</div>
          <div class="cv-job-title-preview" id="cvJobTitlePreview">Titre du Poste Visé</div>

          <div class="cv-section-preview" id="cvSummarySectionPreview" style="display:none;">
            <h4>À propos de moi</h4>
            <p id="cvSummaryPreview"></p>
          </div>

          <div class="cv-section-preview" id="cvExperiencesSectionPreview" style="display:none;">
            <h4>Expériences Professionnelles</h4>
            <ul id="cvExperiencesPreview"></ul>
          </div>

          <div class="cv-section-preview" id="cvEducationsSectionPreview" style="display:none;">
            <h4>Formations</h4>
            <ul id="cvEducationsPreview"></ul>
          </div>

          <div class="cv-section-preview" id="cvSkillsSectionPreview" style="display:none;">
            <h4>Compétences</h4>
            <ul id="cvSkillsPreview"></ul>
          </div>
        </div>
        <button id="downloadPdfBtn" class="action-button btn-pdf" onclick="downloadPDF()">
          <i class="fas fa-file-pdf"></i> Télécharger mon CV en PDF
        </button>
        <a href="choix-lm.html" class="action-button btn-lm">
          <i class="fas fa-envelope-open-text"></i> Créer ma Lettre de Motivation
        </a>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Fonction pour générer un ID unique pour les éléments
    function generateId() {
        return '_' + Math.random().toString(36).substr(2, 9);
    }

    // Fonctions pour ajouter des sections dynamiques (Expériences / Formations)
    function createExperienceHTML(id) {
        return `
            <div class="dynamic-item-container" id="exp-${id}">
                <button type="button" class="remove-item-btn" onclick="removeItem('exp-${id}')">
                    <i class="fas fa-trash-alt"></i> Supprimer
                </button>
                <div class="form-group">
                    <label for="exp-job-${id}">Poste occupé :</label>
                    <input type="text" id="exp-job-${id}" class="exp-job" placeholder="Ex: Vendeur, Agent d'entretien" oninput="updatePreview()">
                </div>
                <div class="form-group">
                    <label for="exp-company-${id}">Entreprise :</label>
                    <input type="text" id="exp-company-${id}" class="exp-company" placeholder="Ex: Carrefour, Mairie de Lille" oninput="updatePreview()">
                </div>
                <div class="form-group">
                    <label for="exp-dates-${id}">Dates (ex: Mars 2022 - Juin 2023) :</label>
                    <input type="text" id="exp-dates-${id}" class="exp-dates" placeholder="Ex: 2022 - 2023" oninput="updatePreview()">
                </div>
                <div class="form-group">
                    <label for="exp-desc-${id}">Ce que vous avez fait (optionnel) :</label>
                    <textarea id="exp-desc-${id}" class="exp-desc" rows="3" placeholder="Ex: Accueil des clients, mise en rayon, encaissement" oninput="updatePreview()"></textarea>
                </div>
            </div>`;
    }

    function createEducationHTML(id) {
        return `
            <div class="dynamic-item-container" id="edu-${id}">
                <button type="button" class="remove-item-btn" onclick="removeItem('edu-${id}')">
                    <i class="fas fa-trash-alt"></i> Supprimer
                </button>
                <div class="form-group">
                    <label for="edu-degree-${id}">Diplôme / Formation :</label>
                    <input type="text" id="edu-degree-${id}" class="edu-degree" placeholder="Ex: CAP Vente, Titre Professionnel Agent d'accueil" oninput="updatePreview()">
                </div>
                <div class="form-group">
                    <label for="edu-school-${id}">École / Organisme :</label>
                    <input type="text" id="edu-school-${id}" class="edu-school" placeholder="Ex: Lycée Jean Moulin, AFPA" oninput="updatePreview()">
                </div>
                <div class="form-group">
                    <label for="edu-dates-${id}">Dates d'obtention (ex: 2020 - 2022) :</label>
                    <input type="text" id="edu-dates-${id}" class="edu-dates" placeholder="Ex: 2022" oninput="updatePreview()">
                </div>
            </div>`;
    }

    function addExperience() {
      const id = generateId();
      const experiencesContainer = document.getElementById('experiencesContainer');
      experiencesContainer.insertAdjacentHTML('beforeend', createExperienceHTML(id));
      updatePreview();
    }

    function addEducation() {
      const id = generateId();
      const educationsContainer = document.getElementById('educationsContainer');
      educationsContainer.insertAdjacentHTML('beforeend', createEducationHTML(id));
      updatePreview();
    }

    function removeItem(elementId) {
        const item = document.getElementById(elementId);
        if (item) {
            item.remove();
            updatePreview();
        }
    }

    function updatePreview() {
      // Informations personnelles
      document.getElementById('cvNamePreview').textContent = document.getElementById('fullname').value.trim() || "Prénom NOM";

      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      let contactInfo = [];
      if (email) contactInfo.push(email);
      if (phone) contactInfo.push(phone);
      if (address) contactInfo.push(address);
      document.getElementById('cvContactPreview').textContent = contactInfo.join('  •  ') || "infos@contact.fr  •  0102030405  •  Ville";

      document.getElementById('cvJobTitlePreview').textContent = document.getElementById('jobtitle').value.trim() || "Titre du Poste Visé";

      // Résumé
      const summary = document.getElementById('summary').value.trim();
      const summarySection = document.getElementById('cvSummarySectionPreview');
      const summaryPreview = document.getElementById('cvSummaryPreview');
      if (summary) {
        summaryPreview.textContent = summary;
        summarySection.style.display = 'block';
      } else {
        summarySection.style.display = 'none';
      }

      // Expériences
      const experiencesPreview = document.getElementById('cvExperiencesPreview');
      const experiencesSection = document.getElementById('cvExperiencesSectionPreview');
      experiencesPreview.innerHTML = '';
      let hasExperiences = false;
      document.querySelectorAll('#experiencesContainer .dynamic-item-container').forEach(expDiv => {
        const job = expDiv.querySelector('.exp-job').value.trim();
        const company = expDiv.querySelector('.exp-company').value.trim();
        const dates = expDiv.querySelector('.exp-dates').value.trim();
        const desc = expDiv.querySelector('.exp-desc').value.trim();
        if (job || company || dates) {
          hasExperiences = true;
          let itemHTML = `<li><strong>${job || 'Poste non précisé'}</strong>`;
          if (company) itemHTML += ` chez ${company}`;
          if (dates) itemHTML += ` (${dates})`;
          itemHTML += `</li>`;
          if (desc) {
            itemHTML += `<ul style="list-style-type:circle; margin-left:20px; margin-bottom: 8px;">${desc.split('\n').map(d => `<li>${d}</li>`).join('')}</ul>`;
          }
          experiencesPreview.innerHTML += itemHTML;
        }
      });
      experiencesSection.style.display = hasExperiences ? 'block' : 'none';


      // Formations
      const educationsPreview = document.getElementById('cvEducationsPreview');
      const educationsSection = document.getElementById('cvEducationsSectionPreview');
      educationsPreview.innerHTML = '';
      let hasEducations = false;
      document.querySelectorAll('#educationsContainer .dynamic-item-container').forEach(eduDiv => {
        const degree = eduDiv.querySelector('.edu-degree').value.trim();
        const school = eduDiv.querySelector('.edu-school').value.trim();
        const dates = eduDiv.querySelector('.edu-dates').value.trim();
        if (degree || school || dates) {
          hasEducations = true;
          educationsPreview.innerHTML += `<li><strong>${degree || 'Formation non précisée'}</strong> ${school ? ' - ' + school : ''} ${dates ? '(' + dates + ')' : ''}</li>`;
        }
      });
      educationsSection.style.display = hasEducations ? 'block' : 'none';

      // Compétences
      const skills = document.getElementById('skills').value.trim();
      const skillsPreview = document.getElementById('cvSkillsPreview');
      const skillsSection = document.getElementById('cvSkillsSectionPreview');
      if (skills) {
        const skillList = skills.split(',').map(s => s.trim()).filter(Boolean);
        skillsPreview.innerHTML = skillList.map(s => `<li>${s}</li>`).join('');
        skillsSection.style.display = 'block';
      } else {
        skillsPreview.innerHTML = '';
        skillsSection.style.display = 'none';
      }
    }

    // Initialiser avec un champ vide pour expérience et formation pour guider
    addExperience();
    addEducation();
    updatePreview(); // Premier affichage

    async function downloadPDF() {
      const downloadBtn = document.getElementById('downloadPdfBtn');
      const originalBtnText = downloadBtn.innerHTML;
      downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Création du PDF...';
      downloadBtn.disabled = true;

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: "a4",
        putOnlyUsedFonts:true
      });

      let y = 20; // Marge haute
      const pageHeight = doc.internal.pageSize.height;
      const margin = 20;
      const usableWidth = doc.internal.pageSize.width - 2 * margin;

      function checkPageBreak(neededHeight) {
          if (y + neededHeight > pageHeight - margin) {
              doc.addPage();
              y = margin;
          }
      }

      // Nom
      checkPageBreak(15);
      doc.setFont("Helvetica", "bold");
      doc.setFontSize(22);
      const name = document.getElementById('fullname').value.trim() || "Prénom NOM";
      doc.text(name, doc.internal.pageSize.width / 2, y, { align: "center" });
      y += 10;

      // Contact
      checkPageBreak(10);
      doc.setFont("Helvetica", "normal");
      doc.setFontSize(10);
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      let contactParts = [];
      if (email) contactParts.push(email);
      if (phone) contactParts.push(phone);
      if (address) contactParts.push(address);
      doc.text(contactParts.join('  |  '), doc.internal.pageSize.width / 2, y, { align: "center" });
      y += 8;

      // Titre du poste
      checkPageBreak(10);
      doc.setFont("Helvetica", "bold");
      doc.setFontSize(14);
      const jobTitle = document.getElementById('jobtitle').value.trim() || "Titre du Poste Visé";
      doc.text(jobTitle, doc.internal.pageSize.width / 2, y, { align: "center" });
      y += 12;

      // Résumé
      const summary = document.getElementById('summary').value.trim();
      if (summary) {
        checkPageBreak(15);
        doc.setFont("Helvetica", "bold");
        doc.setFontSize(12);
        doc.text("À propos de moi", margin, y);
        y += 6;
        doc.setFont("Helvetica", "normal");
        doc.setFontSize(10);
        const summaryLines = doc.splitTextToSize(summary, usableWidth);
        checkPageBreak(summaryLines.length * 5);
        doc.text(summaryLines, margin, y);
        y += summaryLines.length * 5 + 5;
      }

      // Expériences
      const experiences = Array.from(document.querySelectorAll('#experiencesContainer .dynamic-item-container'));
      if (experiences.some(expDiv => expDiv.querySelector('.exp-job').value.trim() || expDiv.querySelector('.exp-company').value.trim())) {
        checkPageBreak(15);
        doc.setFont("Helvetica", "bold");
        doc.setFontSize(12);
        doc.text("Expériences Professionnelles", margin, y);
        y += 7;
        doc.setFont("Helvetica", "normal");
        doc.setFontSize(10);
        experiences.forEach(expDiv => {
          const job = expDiv.querySelector('.exp-job').value.trim();
          const company = expDiv.querySelector('.exp-company').value.trim();
          const dates = expDiv.querySelector('.exp-dates').value.trim();
          const desc = expDiv.querySelector('.exp-desc').value.trim();
          if (job || company || dates) {
            let expText = `${job || 'Poste non précisé'}`;
            if (company) expText += ` chez ${company}`;
            if (dates) expText += ` (${dates})`;

            checkPageBreak(8);
            doc.setFont("Helvetica", "bold");
            doc.text(`• ${expText}`, margin, y);
            y += 5;

            if (desc) {
                doc.setFont("Helvetica", "normal");
                const descLines = doc.splitTextToSize(desc, usableWidth - 5); // Légère indentation
                descLines.forEach(line => {
                    checkPageBreak(5);
                    doc.text(line, margin + 5, y);
                    y += 5;
                });
            }
            y += 3; // Espace après une expérience
          }
        });
        y += 5;
      }

      // Formations
      const educations = Array.from(document.querySelectorAll('#educationsContainer .dynamic-item-container'));
      if (educations.some(eduDiv => eduDiv.querySelector('.edu-degree').value.trim() || eduDiv.querySelector('.edu-school').value.trim())) {
        checkPageBreak(15);
        doc.setFont("Helvetica", "bold");
        doc.setFontSize(12);
        doc.text("Formations", margin, y);
        y += 7;
        doc.setFont("Helvetica", "normal");
        doc.setFontSize(10);
        educations.forEach(eduDiv => {
          const degree = eduDiv.querySelector('.edu-degree').value.trim();
          const school = eduDiv.querySelector('.edu-school').value.trim();
          const dates = eduDiv.querySelector('.edu-dates').value.trim();
          if (degree || school || dates) {
            let eduText = `• ${degree || 'Formation non précisée'}`;
            if (school) eduText += ` - ${school}`;
            if (dates) eduText += ` (${dates})`;
            checkPageBreak(5);
            doc.text(eduText, margin, y);
            y += 5;
          }
        });
        y += 5;
      }

      // Compétences
      const skillsText = document.getElementById('skills').value.trim();
      if (skillsText) {
        checkPageBreak(15);
        doc.setFont("Helvetica", "bold");
        doc.setFontSize(12);
        doc.text("Compétences", margin, y);
        y += 7;
        doc.setFont("Helvetica", "normal");
        doc.setFontSize(10);
        const skillList = skillsText.split(',').map(s => s.trim()).filter(Boolean);
        skillList.forEach(skill => {
          checkPageBreak(5);
          doc.text(`• ${skill}`, margin, y);
          y += 5;
        });
      }

      doc.save((name.replace(/\s+/g, '_') || "Mon-CV") + "-EmploiAvenir.pdf");

      downloadBtn.innerHTML = originalBtnText;
      downloadBtn.disabled = false;
    }
  </script>
</body>
</html>